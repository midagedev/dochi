# Dochi - 컨셉 문서

## 정의

Dochi는 개인/팀을 위한 범용 LLM 인터페이스입니다. 사용자와 디바이스가 하나의 워크스페이스에 참여하고, AI가 그 안에서 컨텍스트를 유지하며 동작합니다.

## 이름

"도치"는 고슴도치에서 따왔습니다. 부르기 쉬운 이름이 필요했습니다.

## 핵심 목표

**사용자, 디바이스, AI가 하나의 워크스페이스에서 연결된다.**

슬랙에서 사용자와 봇이 같은 채널에 있듯이, Dochi에서는 사람도 디바이스도 AI도 모두 하나의 워크스페이스 안의 참여자입니다. 차이점은 참여자 중 하나가 AI이고, 디바이스가 물리적 능력(음성, 알람 등)을 가진다는 것입니다.

## 워크스페이스 모델

```
워크스페이스 (가족 / 팀)
│
├── 참여자
│   ├── 사용자: 엄마, 아빠, 민수    ← 프로필, 개인 기억
│   ├── 디바이스: 집 Mac, 업무 Mac  ← 로컬 능력, 상태
│   ├── 봇: 텔레그램, 슬랙          ← 외부 인터페이스
│   └── AI: 도치                    ← LLM, 공유 기억
│
├── 컨텍스트
│   ├── 공유: system.md, 공유 기억  ← 워크스페이스 전체
│   ├── 개인: 사용자별 기억          ← 프로필에 귀속
│   └── 로컬: 기기별 오버라이드      ← 디바이스에 귀속
│
└── 대화
    ├── DM: 나 ↔ AI (기본)
    ├── 디바이스 메시징: 텔레그램 → 집 Mac TTS
    └── 공유 채널: 팀 슬랙 채널 + AI
```

### 대화 계층

| 계층 | 설명 | 예시 |
|------|------|------|
| **1. DM** | 나와 AI의 1:1 대화 (기본) | 텍스트 질문, 음성 대화 |
| **2. 멀티 디바이스** | 같은 DM을 여러 기기에서 | 집에서 시작한 대화를 업무 Mac에서 이어감 |
| **3. 멀티 유저** | 각자의 DM + 공유 기억 | 가족 구성원별 프로필, 공유 일정 |
| **4. 피어 메시징** | 사람 → 디바이스 | 텔레그램 "밥 먹어!" → 집 Mac TTS |
| **5. 공유 채널** | 여러 사람 + AI | 슬랙 팀 채널에서 AI 어시스턴트 |

아래로 갈수록 나중에 구현합니다. 1~2가 다음 단계의 핵심입니다.

## 설계 원칙

1. **피어 기반** — 모든 디바이스가 독립적으로 동작. 클라우드는 조율자
2. **쉬운 특화** — 마크다운 파일 편집만으로 페르소나와 동작 변경
3. **투명하게** — 오픈소스, 데이터 흐름이 명확
4. **확장 가능하게** — 프로토콜 기반 구조, MCP로 도구 확장

## 아키텍처

```
                ┌────────────────────────────────┐
                │     Supabase (조율 계층)         │
                │  Auth / Context / 편집 히스토리   │
                │  메시지 큐 / 디바이스 레지스트리    │
                └───────────────┬────────────────┘
                                │
       ┌────────────────────────┼────────────────────────┐
       │                        │                        │
┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│   집 Mac    │          │  업무 Mac   │          │  메신저 봇   │
│  음성비서   │          │  텍스트/CLI  │          │  TG / Slack │
│  3D 아바타  │   ←→     │  MCP 도구   │   ←→     │  팀/가족    │
│  알람/TTS   │          │  에이전트    │          │  피어 메시징 │
└─────────────┘          └─────────────┘          └─────────────┘
     피어                      피어                      피어
```

### 클라우드 (Supabase)

클라우드는 중앙 서버가 아니라 **조율 계층**입니다:
- **Auth**: 워크스페이스 인증
- **Context DB**: 공유/개인 컨텍스트 저장, 편집 히스토리 추적
- **메시지 큐**: 피어 간 메시지 라우팅 (텔레그램 → 집 Mac 등)
- **디바이스 레지스트리**: 등록된 디바이스 목록, 온라인 상태, capabilities
- **태스크 큐**: 에이전트 태스크 분배, 칸반 상태 관리

### 디바이스 (피어)

각 피어는 독립적으로 동작하며 자기 기기의 능력을 제공합니다:
- LLM 호출, 도구 실행은 각 피어가 직접 수행
- 한 피어가 꺼져도 나머지에 영향 없음
- Heartbeat로 클라우드에 상태 보고

### 에이전트 오케스트레이션

- **Heartbeat**: 각 디바이스가 주기적으로 상태 보고
- **태스크 큐**: 클라우드에 등록된 태스크를 가용 디바이스에 분배
- **칸반**: 태스크 상태 추적, 디바이스 간 핸드오프

## 인터페이스

| 인터페이스 | 입력 | 출력 | 로컬 기능 | 상태 |
|-----------|------|------|----------|------|
| macOS 앱 | 텍스트, 음성 | TTS, 텍스트, 이미지, 3D | 음성비서, 알람, 미리알림 | 구현됨 |
| CLI | 텍스트 | 텍스트 | 스크립팅, 파이프라인 | 계획 |
| 텔레그램 봇 | 텍스트, 음성메시지 | 텍스트, 이미지 | 모바일 접근, 피어 메시징 | 계획 |
| 슬랙 봇 | 텍스트 | 텍스트 | 팀 채널, 피어 메시징 | 계획 |

## 사용 시나리오

### 가정

- 집 Mac이 항상 켜져서 음성비서로 동작 (웨이크워드, 3D 캐릭터)
- 아이가 "도치야" 하면 캐릭터가 반응하며 대화
- 부모는 외출 중 텔레그램으로 같은 AI에게 질문
- 텔레그램에서 "밥 먹어!" → 집 Mac이 TTS로 아이들에게 전달
- 가족 구성원별 프로필과 기억이 분리되어 있지만 공유 기억도 존재

### 개발

- 업무 Mac에서 CLI로 빠르게 질의
- MCP 서버 연동으로 개발 도구와 통합
- Heartbeat 태스크로 모니터링/알림 자동화
- 집 Mac의 에이전트가 야간 배치 작업 수행

### 업무

- 슬랙 봇으로 팀 채널에서 AI 어시스턴트 활용
- 여러 기기에서 동일한 업무 컨텍스트 유지
- 칸반 태스크 관리로 작업 흐름 자동화
