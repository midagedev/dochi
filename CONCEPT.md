# Dochi - 컨셉 문서

## 한 줄 정의

디바이스에 상주하며 로컬 환경을 직접 제어하는 AI 에이전트 플랫폼.

## 핵심 목표

**AI에게 손과 발을 준다.**

클라우드 AI는 텍스트를 주고받을 뿐, 내 컴퓨터에서 아무것도 할 수 없습니다. Dochi의 에이전트는 디바이스에 상주하며 bash를 실행하고, 앱을 열고, 파일을 관리하고, 코딩 에이전트에 작업을 시킵니다. 에이전트마다 고유한 페르소나와 권한을 갖고, 워크스페이스 단위로 컨텍스트를 공유합니다.

## 세 가지 축

Dochi는 세 가지 축 위에 설계됩니다.

### 1. 로컬 디바이스 제어

에이전트가 macOS의 능력을 직접 사용합니다.

| 능력 | 방법 | 예시 |
|------|------|------|
| Shell 실행 | bash/zsh | `npm run build`, `git status` |
| 코딩 에이전트 | Claude Code, OpenCode CLI | 코드 작성 위임, 세션 관리, 결과 중계 |
| 앱 제어 | open, AppleScript | FaceTime 통화, Keynote 열기 |
| 파일 관리 | FileManager | 읽기/쓰기/검색/정리 |
| Shortcuts | shortcuts CLI | 사용자 정의 자동화 |
| 미리알림/캘린더 | EventKit | 일정, 할 일 |
| 스크린샷 | screencapture | 화면 캡처 → LLM 전달 |
| 클립보드 | NSPasteboard | 복사/붙여넣기 |

**코딩 에이전트 연동**은 단순히 앱을 여는 것이 아닙니다. Dochi가 Claude Code 세션을 시작하고, 자연어 지시를 전달하고, 결과를 요약해서 돌려줍니다. 세션을 재개하거나 여러 세션을 병렬 관리할 수도 있습니다.

**권한 모델**: 에이전트마다 실행 가능한 범위가 다릅니다.

```
도치 (비서):  앱 열기 ✓ | 파일 읽기 ✓ | bash 제한적 ✓ | rm -rf ✗
코디 (개발):  bash 전체 ✓ | 파일 쓰기 ✓ | git ✓ | 시스템 설정 ✗
키키 (아이):  미리알림 ✓ | 앱 열기 ✓ | bash ✗ | 파일 쓰기 ✗
```

위험 명령은 항상 사용자 확인을 거칩니다.

### 2. 멀티 에이전트

워크스페이스 안에 여러 에이전트가 공존합니다. 각 에이전트는 `system.md`로 정의됩니다.

| 요소 | 설명 |
|------|------|
| 페르소나 | 성격, 말투, 역할 |
| 웨이크워드 | 음성 호출어 ("도치야", "코디야") |
| 도구 권한 | 사용 가능한 도구와 명령 범위 |
| 기억 | 워크스페이스 기억 + 에이전트 고유 기억 |

에이전트를 만들려면 `system.md`를 작성하고 이름, 웨이크워드, 권한을 지정합니다.

### 3. 컨텍스트 관리

컨텍스트는 4개 계층으로 나뉘며, LLM 프롬프트에 순서대로 조합됩니다.

```
에이전트 지침 (system.md)   ← 페르소나, 행동 규칙
워크스페이스 기억            ← 해당 워크스페이스 멤버 전체가 공유
에이전트 기억               ← 에이전트가 대화에서 자동 축적
개인 컨텍스트               ← 사용자 소유, 모든 워크스페이스에서 접근
```

| 계층 | 소유 | 범위 | 예시 |
|------|------|------|------|
| 에이전트 지침 | 에이전트 | 에이전트 | "너는 시니어 개발자 코디야" |
| 워크스페이스 기억 | 워크스페이스 | 멤버 전체 | "스프린트 3주차", "고양이 나비" |
| 에이전트 기억 | 에이전트 | 에이전트 | "이 프로젝트는 Swift+SwiftUI" |
| 개인 컨텍스트 | 사용자 | 전체 워크스페이스 | "커피 좋아함", "알러지: 새우" |

**개인 컨텍스트**는 dotfiles처럼 동작합니다. 클라우드에 동기화되어, 새 워크스페이스에 참여하거나 새 디바이스를 추가해도 AI가 나를 즉시 이해합니다. 사용자가 직접 확인하고 편집할 수 있으며, 다른 멤버에게 노출되지 않습니다.

**멀티 워크스페이스**: 사용자는 가족, 팀, 사이드 프로젝트 등 여러 워크스페이스를 운영합니다. 하나의 디바이스가 여러 워크스페이스에 동시에 등록되어, 같은 Mac에서 가족 에이전트와 팀 에이전트가 함께 동작합니다.

```
사용자 (아빠)
├── 개인 컨텍스트                ← 모든 WS에서 접근
├── 가족 WS
│   ├── 워크스페이스 기억
│   ├── 도치, 키키
│   └── 디바이스: 집 Mac ──┐
└── 팀 WS                   │    하나의 디바이스가
    ├── 워크스페이스 기억     │    여러 WS에 참여
    ├── 코디               │
    └── 디바이스: 집 Mac ──┘, 업무 Mac
```

## 아키텍처

```
              ┌──────────────────────────────┐
              │     Supabase (동기화 계층)     │
              │  Auth · WS 관리 · 메시지 큐    │
              │  컨텍스트 동기화 · 디바이스 관리  │
              └──────────────┬───────────────┘
                             │
        ┌────────────────────┼────────────────────┐
        │                    │                    │
 ┌──────┴──────┐      ┌─────┴──────┐      ┌─────┴──────┐
 │   집 Mac    │      │  업무 Mac  │      │  메신저 봇  │
 │ [가족+팀 WS]│      │  [팀 WS]  │      │  [팀 WS]  │
 │ 도치·키키·코디│      │   코디    │      │ TG / Slack│
 │ TTS·FaceTime│      │ bash·git  │      │ 피어 메시징 │
 │  Shortcuts  │      │Claude Code│      │           │
 └─────────────┘      └───────────┘      └───────────┘
```

**클라우드**: 동기화만 담당합니다. LLM 호출, 도구 실행, 명령 실행은 모두 디바이스에서 직접 수행합니다.

**디바이스(피어)**: 독립적으로 동작합니다. 한 피어가 꺼져도 나머지에 영향 없습니다. 여러 워크스페이스의 에이전트가 하나의 디바이스에서 동시에 활성화됩니다.

## 사용 시나리오

### 같은 Mac, 다른 워크스페이스

```
"도치야, 민수 숙제 도와줘"     → 가족 WS 컨텍스트 · 도치
"코디야, PR 리뷰해줘"          → 팀 WS 컨텍스트 · 코디
"도치야, 내 알러지 뭐였지?"     → 개인 컨텍스트 · 어느 WS든 동일
```

### 가정

- "키키야, 공룡 이야기 해줘" → 아이 눈높이로 대화
- "도치야, 엄마한테 FaceTime 걸어줘" → FaceTime 실행
- 텔레그램에서 "밥 먹어!" → 집 Mac TTS로 전달

### 개발

- "코디야, rate limit 추가해줘" → Claude Code 세션 → 코드 수정 → 결과 요약
- "코디야, 아까 작업 이어서" → 기존 코딩 세션 재개
- "코디야, 테스트 돌려줘" → 실행 후 결과 요약
- 업무 Mac에서도 같은 팀 컨텍스트로 이어서 작업

## 설계 원칙

1. **로컬 우선** — 실행은 디바이스에서. 클라우드는 동기화만
2. **선언적 에이전트** — `system.md` 하나로 에이전트 생성
3. **투명** — 오픈소스, 실행 전 명령 표시
4. **안전** — 에이전트별 권한 분리, 위험 명령 사용자 확인

## 인터페이스

| 인터페이스 | 로컬 능력 | 상태 |
|-----------|----------|------|
| macOS 앱 | bash, 앱 제어, TTS/STT, Shortcuts | 구현 중 |
| CLI | bash, 파이프라인 | 계획 |
| 텔레그램 봇 | 원격 디바이스 명령 | 계획 |
| 슬랙 봇 | 팀 채널, 원격 명령 | 계획 |
