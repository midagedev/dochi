# Dochi - 컨셉 문서

## 정의

Dochi는 로컬 디바이스의 능력을 가진 AI 에이전트 플랫폼입니다. 각 에이전트는 고유한 페르소나를 갖고, 디바이스에서 직접 명령을 실행하며, 사용자와 자연스럽게 상호작용합니다.

## 이름

"도치"는 고슴도치에서 따왔습니다. 부르기 쉬운 이름이 필요했습니다.

## 핵심 목표

**AI 에이전트가 로컬 디바이스를 몸처럼 사용한다.**

ChatGPT나 Claude 같은 클라우드 AI는 텍스트만 주고받습니다. Dochi의 에이전트는 다릅니다. 디바이스에 상주하며 bash를 실행하고, 앱을 열고, 파일을 읽고, 시스템을 제어합니다. AI에게 손과 발을 주는 것입니다.

## 에이전트 모델

```
워크스페이스 (가족 / 팀)
│
├── 에이전트들
│   ├── 도치 (기본)      ← 범용 비서, 음성 대화
│   ├── 코디            ← 개발 전문, Claude Code 연동
│   ├── 키키            ← 아이 대화 상대, 교육
│   └── (커스텀)        ← system.md 하나로 새 에이전트 생성
│
├── 사용자
│   ├── 엄마, 아빠, 민수  ← 프로필, 개인 기억
│   └── 팀원들           ← 업무 컨텍스트
│
├── 디바이스
│   ├── 집 Mac          ← 음성, TTS, 앱 제어, bash
│   ├── 업무 Mac        ← CLI, 개발 도구, 자동화
│   └── 메신저 봇       ← 텔레그램, 슬랙 (원격 접근)
│
└── 컨텍스트
    ├── 공유 기억        ← 워크스페이스 전체
    ├── 개인 기억        ← 사용자별
    ├── 에이전트별 지침   ← 각 에이전트의 system.md
    └── 디바이스 상태     ← 로컬 capabilities
```

### 에이전트 = 페르소나 + 능력

각 에이전트는 독립적인 `system.md`로 정의됩니다:

| 요소 | 설명 | 예시 |
|------|------|------|
| **페르소나** | 성격, 말투, 역할 | "친절한 비서", "시니어 개발자", "호기심 많은 친구" |
| **도구 권한** | 사용 가능한 도구 목록 | 코디: bash + 파일 전체 허용 / 키키: bash 제한 |
| **웨이크워드** | 음성 호출어 | "도치야", "코디야", "키키야" |
| **기억** | 공유 기억 + 에이전트 고유 기억 | 코디: 프로젝트 히스토리 / 키키: 학습 진도 |

새 에이전트를 만들려면 `system.md`를 작성하고 이름과 웨이크워드를 지정하면 됩니다.

## 로컬 디바이스 능력

Dochi의 핵심 차별점은 **로컬 디바이스를 직접 제어**하는 것입니다.

### Shell 실행

에이전트가 bash 명령어를 직접 실행합니다:

```
사용자: "프로젝트 빌드해줘"
코디:   $ cd ~/repo/myapp && npm run build
        → 빌드 완료. 에러 없음.

사용자: "디스크 용량 확인해줘"
도치:   $ df -h /
        → 256GB 중 180GB 사용 (70%). 여유 76GB.
```

### 앱 제어

macOS 앱을 열고 조작합니다:

```
사용자: "엄마한테 FaceTime 걸어줘"
도치:   → FaceTime 열기 → 엄마 연락처로 통화 시작

사용자: "이 코드 Claude Code로 열어줘"
코디:   → claude 실행 → 현재 프로젝트 컨텍스트 전달

사용자: "발표자료 키노트로 열어줘"
도치:   → Keynote에서 파일 열기
```

### 지원하는 로컬 능력

| 능력 | 방법 | 예시 |
|------|------|------|
| **Shell 실행** | bash/zsh | 빌드, 스크립트, 시스템 조회 |
| **앱 열기/제어** | open, AppleScript | FaceTime, Keynote, Finder, Claude Code |
| **파일 관리** | 파일시스템 접근 | 파일 읽기/쓰기/정리 |
| **Apple Shortcuts** | shortcuts CLI | 사용자 정의 자동화 실행 |
| **미리알림/캘린더** | EventKit | 일정 관리, 할 일 추가 |
| **알림** | UserNotifications | 시스템 알림 표시 |
| **클립보드** | NSPasteboard | 복사/붙여넣기 |
| **스크린샷** | screencapture | 화면 캡처 |
| **음성 TTS** | Supertonic ONNX | 한국어 음성 출력 |
| **음성 STT** | Apple Speech | 음성 인식 입력 |

### 권한 모델

에이전트마다 실행 가능한 명령의 범위가 다릅니다:

```
도치 (기본):  앱 열기 ✓ | 파일 읽기 ✓ | bash 제한적 ✓ | rm -rf ✗
코디 (개발):  bash 전체 ✓ | 파일 쓰기 ✓ | git ✓ | 시스템 설정 ✗
키키 (아이):  앱 열기 ✓ | 미리알림 ✓ | bash ✗ | 파일 쓰기 ✗
```

위험한 명령은 사용자 확인을 요청합니다:
```
코디: rm -rf node_modules를 실행할까요? [Y/n]
```

## 대화 계층

| 계층 | 설명 | 예시 |
|------|------|------|
| **1. DM** | 나와 에이전트의 1:1 | "도치야, 오늘 일정 알려줘" |
| **2. 멀티 디바이스** | 같은 대화를 여러 기기에서 | 집에서 시작한 대화를 업무 Mac에서 이어감 |
| **3. 멀티 유저** | 각자의 DM + 공유 기억 | 가족 구성원별 프로필 |
| **4. 피어 메시징** | 사람 → 디바이스 | 텔레그램 "밥 먹어!" → 집 Mac TTS |
| **5. 공유 채널** | 여러 사람 + 에이전트 | 슬랙 채널에서 코디가 코드 리뷰 |

## 설계 원칙

1. **로컬 우선** — 디바이스에서 직접 실행. 클라우드는 동기화만
2. **에이전트 확장** — system.md 하나로 새 에이전트 생성
3. **투명하게** — 오픈소스, 실행 전 명령어 표시
4. **안전하게** — 에이전트별 권한 분리, 위험 명령 사용자 확인

## 아키텍처

```
                ┌────────────────────────────────┐
                │     Supabase (동기화 계층)       │
                │  Auth / Context / 메시지 큐      │
                │  디바이스 레지스트리 / 태스크 큐    │
                └───────────────┬────────────────┘
                                │
       ┌────────────────────────┼────────────────────────┐
       │                        │                        │
┌──────┴──────┐          ┌──────┴──────┐          ┌──────┴──────┐
│   집 Mac    │          │  업무 Mac   │          │  메신저 봇   │
│             │          │             │          │             │
│ 도치: 음성비서│          │ 코디: 개발   │          │ TG / Slack  │
│ 키키: 아이친구│          │  bash, git  │          │ 원격 접근    │
│ FaceTime    │          │ Claude Code │          │ 피어 메시징  │
│ TTS, 알람   │          │ MCP 도구    │          │             │
└─────────────┘          └─────────────┘          └─────────────┘
     피어                      피어                      피어
```

### 클라우드 (Supabase)

클라우드는 중앙 서버가 아니라 **동기화 계층**입니다:
- **Auth**: 워크스페이스 인증
- **Context DB**: 공유/개인/에이전트 컨텍스트 동기화
- **메시지 큐**: 피어 간 메시지 라우팅
- **디바이스 레지스트리**: 디바이스 목록, 상태, capabilities
- **태스크 큐**: 에이전트 태스크 분배

### 디바이스 (피어)

각 피어는 독립적으로 동작하며 로컬 능력을 제공합니다:
- LLM 호출, 도구/명령 실행은 각 피어가 직접 수행
- 한 피어가 꺼져도 나머지에 영향 없음
- 여러 에이전트가 한 디바이스에서 동시에 활성화 가능

## 인터페이스

| 인터페이스 | 입력 | 출력 | 로컬 능력 | 상태 |
|-----------|------|------|----------|------|
| macOS 앱 | 텍스트, 음성 | TTS, 텍스트, 이미지 | bash, 앱 제어, 파일, Shortcuts | 구현 중 |
| CLI | 텍스트 | 텍스트 | bash, 파이프라인, 스크립팅 | 계획 |
| 텔레그램 봇 | 텍스트, 음성메시지 | 텍스트, 이미지 | 원격 디바이스 명령 | 계획 |
| 슬랙 봇 | 텍스트 | 텍스트 | 팀 채널, 원격 명령 | 계획 |

## 사용 시나리오

### 가정

- 집 Mac에 도치(비서)와 키키(아이친구) 에이전트가 상주
- "키키야, 공룡 이야기 해줘" → 키키가 아이 눈높이로 대화
- "도치야, 엄마한테 FaceTime 걸어줘" → FaceTime 앱 실행
- 부모는 텔레그램으로 "밥 먹어!" → 집 Mac에서 도치가 TTS로 전달
- "도치야, 내일 일정 알려줘" → 캘린더 조회 후 음성으로 안내

### 개발

- "코디야, 이 프로젝트 빌드해줘" → `npm run build` 실행
- "코디야, Claude Code 열어줘" → claude CLI 실행, 프로젝트 컨텍스트 전달
- "코디야, git log 보여줘" → 최근 커밋 목록 출력
- "코디야, 테스트 돌려줘" → 테스트 실행 후 결과 요약
- MCP 서버 연동으로 외부 도구 확장

### 업무

- 슬랙 채널에서 코디가 코드 리뷰 참여
- "도치야, 오늘 회의 일정 정리해줘" → 캘린더 + 미리알림 연동
- 여러 기기에서 동일한 업무 컨텍스트 유지
