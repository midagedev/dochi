# 리라이트 계획서 (Rewrite Plan)

## Meta
- DRI: TBD (@hckim)
- 상태: Draft
- 생성: 2026-02-12
- 링크: product-spec.md, tech-spec.md, flows.md, llm-requirements.md, data-overview.md, security.md, open-questions.md

## 목표 (Outcomes)
- 스펙 우선: 구현 전에 제품/기술 스펙을 단일 진실원천으로 유지
- 단순하고 안전한 핵심 경험: 텍스트/음성/원격(텔레그램) 3대 플로우를 빠르고 안정적으로
- 로컬 우선과 최소 권한: 위험 동작은 기본 비활성, 명시적 확인 필요

## 비목표 (Non‑Goals)
- 범용 스마트홈 전범위 통합, 자율행동/무인 자동화, 복잡한 멀티 플랫폼 동시 출시

## 산출물 (Deliverables)
- 동작하는 macOS 앱 MVP
- 코어 플로우 수용 기준 충족(flows.md)
- 관측/로그/설정 최소 구성, 릴리즈 노트

## 범위 & 우선순위 (Scope & Priorities)
- Must: 텍스트 대화, 음성 대화(웨이크워드+STT+TTS), 핵심 도구(미리알림/알람/검색/이미지), 컨텍스트(개인/WS/에이전트), 텔레그램 DM
- Should: 모델 선택 기본정책, 컨텍스트 자동 압축, 권한 가드레일/확인 UX
- Could: 모델 라우팅/폴백, 로컬 LLM, 다중 메신저, 코딩 에이전트 심화

## 단계 (Phases)
- Phase 0 — 스펙 정착 & 스캐폴딩
  - 스펙 동결(핵심 섹션), 새 폴더/모듈 구조 생성, 빈 화면/설정/대화 스텁
- Phase 1 — 텍스트 플로우 MVP
  - 컨텍스트 조합, 스트리밍, 도구 호출(안전군), 대화 저장, 취소/에러 처리
- Phase 2 — 음성 플로우
  - 웨이크워드, STT, TTS 파이프라인, 바지‑인/취소, UX 시그널
- Phase 3 — 도구 & 권한
  - 미리알림/알람/검색/이미지, 설정/프로필/WS 편집, 권한/확인 규칙 적용
- Phase 4 — 원격 인터페이스 & 동기화
  - 텔레그램 DM, 진행 스니펫, 보수적 권한, 동기화/리더십 베스트‑에포트
- Phase 5 — 모델 정책 & 최적화
  - 기본 라우팅, 재시도/타임아웃 튜닝, 관측 지표 수집/대시보드(로컬)

## 마일스톤 & 종료 기준 (Exit Criteria)
- M1 텍스트 MVP: flows.md 텍스트 수용 기준 100% 충족, p50/95 지연 목표 달성
- M2 음성 MVP: 웨이크워드 품질 밴드, TTS 최초 오디오 지연 목표 충족
- M3 도구/권한: Safe 카테고리 100%, Sensitive 확인 루프 적용, 원격 기본 제한
- M4 원격/동기화: 텔레그램 플로우 수용 기준 충족, 충돌/장애시 우아한 저하

## 품질 기준 (Quality Targets)
- Latency: 텍스트 첫 부분 ≤ 1.0s(p50)/2.5s(p95), 전체 ≤ 3.5s/7s
- 음성: TTS 최초 오디오 ≤ 800ms(사전 로드)
- 컨텍스트: 80k chars, 최근 30개 메시지(초안)
- 재시도/타임아웃: 2회, 20s/60s(소프트)

## 브랜치 & 변경 관리 (Branching)
- `main`: 보호 브랜치, 리뷰 필수
- `rewrite/*`: 단계별 작업 브랜치(M1/M2/…)
- PR 템플릿: 관련 스펙 섹션 링크, 수용 기준 체크, 리스크/백아웃 기록

## 리스크 & 대응 (Top Risks)
- 음성 품질/지연 변동 → 로컬 캐시/사전 로드, 텍스트 폴백
- 원격 권한 오남용 → 카테고리 제한+확인 루프, 로컬 재확인 필수
- 동기화 장애 → 페일‑오픈, 로컬 우선, 사용자 공지

## 커뮤니케이션 (Cadence)
- 주간 진행 체크: 마일스톤 상태, FAR/FRR/레이턴시, 버그 톱 N
- 데모: 마일스톤 종료 시점 데모/피드백 수렴

## 백아웃 계획 (Backout Plan)
- 기능 플래그로 단계적 롤아웃, 문제가 있으면 비활성화
- 데이터 변경은 선행 마이그레이션/롤백 경로 확보

## 참고 (References)
- 제품 스펙: product-spec.md
- 기술 스펙: tech-spec.md
- 플로우/수용 기준: flows.md
- LLM 요건: llm-requirements.md
- 데이터 개념: data-overview.md
- 보안/권한: security.md
- 미정 과제: open-questions.md
