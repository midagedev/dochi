# Changelog

## v1.4.0

### 새로운 기능
- 텔레그램 연동(앱 내 수신): 앱 실행 중 텔레그램 DM 수신 및 응답
- 스트리밍 응답: 단일 메시지를 editMessage로 실시간 갱신
- 타이핑 인디케이터: 처리 중 sendChatAction(typing) 주기 전송
- 도구 연동: 내장/MCP 도구 호출 중 진행 스니펫 표시(텍스트)
- 이미지 전송: fal.ai로 생성한 이미지를 텔레그램으로 전송(file://은 multipart 업로드)
- Supabase 매핑: 텔레그램 사용자 ↔ 현재 워크스페이스 매핑(베스트 에포트)
- 클라우드 동기화: 대화 저장 시 Supabase에 푸시(CloudConversationService)

### 개선사항
- 중복 방지 안정화: 단일 폴링 루프 보장, 오프셋 체크포인트 지속화, (chat_id,message_id) 멱등 처리
- 스트리밍 경쟁 상태 해결: 플레이스홀더 단 1회 생성, 최종 응답은 편집만 수행
- 설정 UI 정리: 연결 테스트 제거, 상태/최근 chat_id/테스트 발신 추가

### 참고 및 후속 작업
- 멀티 디바이스 동시 수신 방지를 위한 리더 락(Supabase) 제안
- 비스트리밍 모드(타이핑 후 단일 응답) 옵션
- sendMediaGroup 지원 및 캡션 구성, 이미지 개수 제한 옵션
- 매핑/라우팅 UI, 에러 표면화, 토큰별 오프셋 스코프, 웹훅 모드

## v1.3.0

### 새로운 기능
- 다중 사용자 컨텍스트 관리: 가족 구성원별 개인 기억 분리
- 가족 공유 기억 (family.md): 가족 전체에 해당하는 정보 저장
- LLM 내장 도구: save_memory (기억 저장), update_memory (기억 수정/삭제), set_current_user (사용자 식별)
- 웨이크워드 transcript에서 사용자 자동 식별
- 기본 사용자 설정: Push-to-talk 시 자동 할당
- 사용자별 최근 대화 요약 컨텍스트 (최근 5개)
- 설정 UI: 가족 구성원 관리 (추가/삭제/기본 사용자 선택)
- 사이드바: 가족 공유 기억 및 개인 기억 편집

### 개선사항
- 4계층 컨텍스트 구조: system.md → family.md → 개인 기억 → 최근 대화 요약
- 세션 종료 시 경량 보완 분석으로 LLM이 놓친 기억 자동 보완
- 대화 저장 시 userId, summary 필드 추가
- 프로필 미설정 시 기존 단일 사용자 모드로 동작 (역호환)

## v1.2.0

### 새로운 기능
- 이미지 출력(print_image) 내장 도구
- 채팅 글꼴 크기 설정

### 개선사항
- 텍스트/음성 입력 UI 통합: 입력 영역이 상태별로 전환 (텍스트 ↔ 음성)
- 음성 인식 시 오렌지 글로우/펄스 이펙트로 시각적 피드백 강화
- 별도 ListeningOverlay 제거, 입력 영역 내에서 트랜스크립트 표시

### 버그 수정
- listening 상태 전환 시 UI 깜빡임 수정

## v1.1.0

### 새로운 기능
- 내장 도구: Apple 미리알림 (생성/조회/완료)
- 내장 도구: 음성 알람 및 카운트다운 UI
- 내장 도구: 이미지 생성
- 도구 호출/결과를 대화 내 인라인 블록으로 표시
- 응답 중단 버튼 및 어떤 상태에서든 끼어들기(barge-in) 지원
- TTS 에코 방지 (TTS 재생 중 STT가 자기 음성 무시)
- 대화 자동 종료 토글 (채팅 툴바)
- STT 무음 타임아웃 설정 기능
- 시스템 프롬프트에 현재 날짜/시간 포함

### 개선사항
- TTS 문장 분할: 줄바꿈 외에 마침표·물음표·느낌표 뒤 공백에서도 분할
- 메모리 추출 프롬프트 개선 (기억 품질 향상)
- 도구 결과 메시지가 대화 히스토리에 정상 반영
- 내장 도구 서비스를 모듈 구조로 리팩토링
- LLM 모델 목록 최신화
- 앱 아이콘 및 마스코트 이미지 업데이트
- 앱 시작 시 마이크·음성 인식 권한 일괄 요청
- os.Logger 기반 구조화 로깅 도입 (print 전면 교체)

### 버그 수정
- STT 무음 타이머가 멈추는 문제 수정
- TTS용 마크다운 문법 제거 처리
- 음성 인식 중 이전 텍스트가 유실되는 문제 수정
- Swift 6 strict concurrency 관련 SpeechService 크래시 수정
- 권한 요청 시 크래시 수정

## v1.0.0

### 새로운 기능
- 멀티 LLM 제공자 지원 (OpenAI, Anthropic, Z.AI)
- Apple STT를 활용한 음성 입력
- Supertonic TTS를 활용한 자연스러운 한국어 음성 출력
- 웨이크워드 감지 기능
- 연속 대화 모드
- 대화 히스토리 저장 및 관리
- 시스템 프롬프트 커스터마이징 (system.md)
- 사용자 기억 자동 저장 (memory.md)
- 메모리 자동 압축 기능

### 개선사항
- 테스트 가능한 구조로 리팩토링 (프로토콜 기반 DI)
- 단위 테스트 인프라 구축
